<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toko Online Misteri Box</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDK Imports -->
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js"></script>
    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Hamburger Menu Animation */
        .hamburger-icon span {
            display: block;
            width: 25px;
            height: 3px;
            margin: 5px auto;
            background-color: #333;
            transition: all 0.3s ease-in-out;
        }
        .hamburger-icon.open span:nth-child(1) {
            transform: translateY(8px) rotate(45deg);
        }
        .hamburger-icon.open span:nth-child(2) {
            opacity: 0;
        }
        .hamburger-icon.open span:nth-child(3) {
            transform: translateY(-8px) rotate(-45deg);
        }
        /* Mobile sidebar transition */
        .sidebar {
            transition: transform 0.3s ease-in-out;
            transform: translateX(-100%);
        }
        .sidebar.open {
            transform: translateX(0);
        }
        .admin-link {
            display: none; /* Default hidden */
        }
        .admin-active .admin-link {
            display: block; /* Show if admin is active */
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

    <!-- Global Variables & Config -->
    <script>
        // Global variables provided by the environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'toko-app-default';
        // Fallback configuration MUST be complete for Realtime DB
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : JSON.stringify({
            apiKey: "AIzaSyDjR5u6-aqowURTDGqAXpgEGxalgDm0RBE",
            authDomain: "projectone-4016f.firebaseapp.com",
            databaseURL: "https://projectone-4016f-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "projectone-4016f",
            storageBucket: "projectone-4016f.firebasestorage.app",
            messagingSenderId: "485377861739",
            appId: "1:485377861739:web:836b6a59a3406051a2292e"
        }));
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // --- KONSTAN BARU UNTUK MYSTERY BOX ---
        const WA_ADMIN_NUMBER = '6285817938860'; 
        const PAYMENT_LINK = 'https://lynk.id/yustdan'; 
        const ADMIN_PASSWORD = "Masuk22";
    </script>

    <!-- Header / Navbar -->
    <header class="bg-white shadow-md sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold text-indigo-600">Misteri Toko</h1>
                </div>
                <!-- Desktop Navigation -->
                <nav class="hidden md:flex space-x-4 items-center">
                    <a href="#" onclick="showUserView('home')" class="text-gray-600 hover:text-indigo-600 font-medium transition duration-150 ease-in-out">Beranda</a>
                    <a href="#" onclick="showUserView('products')" class="text-gray-600 hover:text-indigo-600 font-medium transition duration-150 ease-in-out">Dijual</a>
                    <a href="#" onclick="showUserView('mystery')" class="text-gray-600 hover:text-indigo-600 font-medium transition duration-150 ease-in-out">Mystery Box</a>
                    <a href="#" onclick="showUserView('leaderboard')" class="text-gray-600 hover:text-indigo-600 font-medium transition duration-150 ease-in-out">Leaderboard</a>
                    
                    <!-- Admin Links and Login Button -->
                    <a href="#" id="desktop-admin-link" onclick="showAdminView('manage-products')" class="text-red-600 hover:text-red-800 font-medium transition duration-150 ease-in-out admin-link ml-4">Admin Panel</a>
                    <button id="admin-login-btn" onclick="openAdminLoginModal()" class="px-3 py-1.5 bg-indigo-500 text-white text-sm font-medium rounded-lg hover:bg-indigo-600 transition">
                        Login Admin
                    </button>
                    <button id="admin-logout-btn" onclick="logoutAdmin()" class="px-3 py-1.5 bg-red-500 text-white text-sm font-medium rounded-lg hover:bg-red-600 transition admin-link hidden">
                        Logout
                    </button>
                </nav>
                <!-- Hamburger Menu (Mobile) -->
                <button id="hamburger-btn" class="md:hidden p-2 rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <div class="hamburger-icon">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </button>
            </div>
        </div>
    </header>

    <!-- Mobile Sidebar -->
    <div id="mobile-sidebar" class="sidebar fixed inset-y-0 left-0 w-64 bg-white shadow-xl z-20 md:hidden p-4">
        <nav class="flex flex-col space-y-4 pt-16">
            <a href="#" onclick="closeSidebar(); showUserView('home')" class="text-lg text-gray-700 hover:text-indigo-600 font-medium">Beranda</a>
            <a href="#" onclick="closeSidebar(); showUserView('products')" class="text-lg text-gray-700 hover:text-indigo-600 font-medium">Dijual</a>
            <a href="#" onclick="closeSidebar(); showUserView('mystery')" class="text-lg text-gray-700 hover:text-indigo-600 font-medium">Mystery Box</a>
            <a href="#" onclick="closeSidebar(); showUserView('leaderboard')" class="text-lg text-gray-700 hover:text-indigo-600 font-medium">Leaderboard</a>
            <a href="#" id="mobile-admin-link" onclick="closeSidebar(); showAdminView('manage-products')" class="text-lg text-red-600 hover:text-red-800 font-medium admin-link border-t pt-4 mt-4">Admin Panel</a>
            <button onclick="closeSidebar(); openAdminLoginModal()" class="w-full py-2 bg-indigo-500 text-white text-sm font-medium rounded-lg hover:bg-indigo-600 transition mt-4">
                Login Admin
            </button>
             <button onclick="closeSidebar(); logoutAdmin()" class="w-full py-2 bg-red-500 text-white text-sm font-medium rounded-lg hover:bg-red-600 transition admin-link mt-2 hidden">
                Logout
            </button>
        </nav>
    </div>
    <div id="sidebar-overlay" onclick="closeSidebar()" class="fixed inset-0 bg-black bg-opacity-50 z-10 hidden md:hidden"></div>

    <!-- Main Content Area -->
    <main class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
        <div id="loading-spinner" class="text-center p-12">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"></div>
            <p class="mt-4 text-gray-600">Memuat data...</p>
        </div>

        <!-- USER VIEW -->
        <div id="user-view" class="hidden">
            <!-- User Home Section (Beranda) -->
            <section id="user-home" class="view-section">
                <h2 class="text-3xl font-extrabold text-gray-900 mb-6 border-b pb-2">Beranda - Rangkuman Produk</h2>
                <div id="category-summary" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Category summaries will be injected here -->
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-indigo-200">
                        <p class="text-indigo-600 font-semibold text-sm">Total Produk</p>
                        <p id="total-products" class="text-4xl font-bold text-gray-800 mt-1">0</p>
                    </div>
                </div>
            </section>

            <!-- User Products Section (Dijual) -->
            <section id="user-products" class="view-section hidden">
                <h2 class="text-3xl font-extrabold text-gray-900 mb-6 border-b pb-2">Semua Produk Dijual</h2>
                <div id="product-list" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6">
                    <!-- Products will be injected here -->
                </div>
            </section>

            <!-- User Mystery Box Section -->
            <section id="user-mystery" class="view-section hidden">
                <h2 class="text-3xl font-extrabold text-gray-900 mb-6 border-b pb-2">Mystery Box Berhadiah</h2>
                <div class="bg-white p-6 rounded-xl shadow-lg border border-red-300 max-w-lg mx-auto text-center">
                    <div class="text-6xl mb-4">üéÅ</div>
                    <h3 class="text-2xl font-bold text-red-600 mb-2">Baju dan Balik Nanti!</h3>
                    <p class="text-gray-600 mb-6">Dapatkan kesempatan memenangkan hadiah istimewa! Harga: Rp 50.000</p>
                    
                    <!-- Tombol Utama Mystery Box (Selalu muncul untuk memicu info pembayaran) -->
                    <button id="mystery-box-cta" onclick="openPaymentInfoModal()" class="w-full py-3 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 transition duration-300 shadow-md">
                        Beli Mystery Box / Lihat Info
                    </button>
                    
                    <div id="mystery-box-status" class="mt-4 text-center">
                        <!-- Status akan diinjeksikan di sini -->
                    </div>
                </div>
            </section>

            <!-- User Leaderboard Section -->
            <section id="user-leaderboard" class="view-section hidden">
                <h2 class="text-3xl font-extrabold text-gray-900 mb-6 border-b pb-2">Leaderboard Pemenang</h2>
                <div class="bg-white p-4 rounded-xl shadow-lg">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">#</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User ID (Pengenal)</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Voucher Hadiah</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tanggal Menang</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboard-table" class="bg-white divide-y divide-gray-200">
                            <!-- Leaderboard data will be injected here -->
                        </tbody>
                    </table>
                </div>
            </section>
        </div>

        <!-- ADMIN VIEW -->
        <div id="admin-view" class="hidden">
            <h2 class="text-3xl font-extrabold text-red-600 mb-6 border-b pb-2">Admin Panel</h2>
            <div class="flex space-x-4 mb-6">
                <button onclick="showAdminView('manage-products')" class="px-4 py-2 rounded-lg text-white bg-red-500 hover:bg-red-600 transition">Kelola Produk</button>
                <button onclick="showAdminView('manage-mystery')" class="px-4 py-2 rounded-lg text-white bg-red-500 hover:bg-red-600 transition">Kelola Mystery Box</button>
                <button onclick="showUserView('home')" class="px-4 py-2 rounded-lg text-gray-600 border border-gray-300 hover:bg-gray-100 transition">Kembali ke User View</button>
            </div>

            <!-- Admin Manage Products -->
            <section id="admin-manage-products" class="admin-section">
                <h3 class="text-2xl font-bold mb-4">Daftar Produk</h3>
                <button onclick="openProductModal()" class="mb-4 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">Tambah Produk Baru</button>
                <div class="bg-white p-4 rounded-xl shadow-lg">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nama</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stok</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Harga</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="admin-product-table" class="bg-white divide-y divide-gray-200">
                            <!-- Admin products will be injected here -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Admin Manage Mystery Box -->
            <section id="admin-manage-mystery" class="admin-section hidden">
                <h3 class="text-2xl font-bold mb-4">Kelola Mystery Box Plays</h3>
                <div class="bg-white p-4 rounded-xl shadow-lg">
                    <p class="mb-4 text-sm text-gray-600">Total User Bermain: <span id="total-mystery-users" class="font-bold">0</span></p>
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User ID (Proxy IP)</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Waktu Beli</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Token Kirim</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Menang?</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Voucher</th>
                            </tr>
                        </thead>
                        <tbody id="admin-mystery-table" class="bg-white divide-y divide-gray-200">
                            <!-- Admin mystery box plays will be injected here -->
                        </tbody>
                    </table>
                </div>
            </section>
        </div>
    </main>
    
    <!-- Modal: Admin Password Login -->
    <div id="admin-login-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm p-6">
            <h3 class="text-xl font-bold text-indigo-600 mb-4">Login Admin</h3>
            <form id="admin-login-form">
                <div class="mb-4">
                    <label for="admin-password" class="block text-sm font-medium text-gray-700">Password</label>
                    <input type="password" id="admin-password" required class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-indigo-500 focus:border-indigo-500">
                </div>
                <p id="admin-login-error" class="text-red-500 text-sm mb-4 hidden">Password salah. Coba lagi.</p>
                <div class="flex justify-end space-x-3">
                    <button type="button" onclick="closeAdminLoginModal()" class="px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition">Batal</button>
                    <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">Masuk</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Modal: Product Form (Admin) - Placeholder -->
    <div id="product-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 hidden items-center justify-center z-30 p-4">
        <!-- Content will be generated by JS functions -->
    </div>

    <!-- Universal Confirmation/Message Modal -->
    <div id="message-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm p-6 text-center">
            <div id="modal-icon" class="text-4xl mb-4 text-indigo-500">üéâ</div>
            <h3 id="modal-title" class="text-xl font-bold text-gray-900 mb-2">Pesan</h3>
            <p id="modal-body" class="text-gray-600 mb-6">Pesan detail.</p>
            <button onclick="closeMessageModal()" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">Tutup</button>
        </div>
    </div>

    <!-- Modal BARU: Payment Information and Token Generation Trigger -->
    <div id="payment-info-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 hidden items-center justify-center z-40 p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md p-6 text-center">
            <h3 class="text-xl font-bold text-red-600 mb-4">Langkah Pembelian Mystery Box</h3>
            <ol class="list-decimal list-inside text-gray-700 space-y-3 mb-6 text-left text-base">
                <li>Bayar Mystery Box (Rp 50.000) melalui link berikut: 
                    <a href="${PAYMENT_LINK}" target="_blank" class="text-indigo-600 font-semibold break-all hover:underline">${PAYMENT_LINK}</a>
                </li>
                <li>Kirim bukti bayar ke WhatsApp Admin: 
                    <a href="https://wa.me/${WA_ADMIN_NUMBER}" target="_blank" class="text-indigo-600 font-semibold break-all hover:underline">${WA_ADMIN_NUMBER}</a>
                </li>
                <li>Tunggu balasan Admin yang akan memberikan **TOKEN RAHASIA** Anda.</li>
                <li>Setelah mendapatkan token, klik tombol di bawah untuk memasukkan token.</li>
            </ol>
            <button onclick="registerPlayAndOpenTokenInput()" class="w-full py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition">
                Saya Sudah Bayar dan Punya Token
            </button>
            <button onclick="closePaymentInfoModal()" class="w-full py-2 mt-3 bg-gray-300 text-gray-800 font-semibold rounded-lg hover:bg-gray-400 transition">
                Tutup / Kembali
            </button>
        </div>
    </div>
    
    <!-- Modal BARU: Token Input for Opening Box -->
    <div id="token-input-modal" class="fixed inset-0 bg-gray-600 bg-opacity-75 hidden items-center justify-center z-40 p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-sm p-6 text-center">
            <h3 class="text-xl font-bold text-green-600 mb-4">Masukkan Token Anda</h3>
            <form id="token-form">
                <div class="mb-4">
                    <label for="mystery-token" class="block text-sm font-medium text-gray-700 mb-1">Token Rahasia (dari Admin):</label>
                    <input type="text" id="mystery-token" required maxlength="6" pattern="[A-Z0-9]{6}"
                        class="mt-1 block w-full text-center text-2xl font-mono border border-gray-300 rounded-md shadow-sm p-2 focus:ring-green-500 focus:border-green-500 uppercase tracking-widest">
                    <p class="text-xs text-gray-500 mt-1">Token 6 digit (A-Z, 0-9)</p>
                </div>
                <p id="token-error" class="text-red-500 text-sm mb-4 hidden">Token salah atau sudah digunakan. Coba lagi.</p>
                <div class="flex justify-center space-x-3">
                    <button type="button" onclick="closeTokenInputModal()" class="px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition">Batal</button>
                    <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">Buka Mystery Box!</button>
                </div>
            </form>
        </div>
    </div>


    <!-- JavaScript & Firebase Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getDatabase, ref, get, set, push, update, onValue, remove } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";
        
        // --- MODULE-SCOPE STATE ---
        let app, auth, db, userId;
        let isAuthReady = false;
        let isAdmin = false;
        let latestPlayId = null; 
        
        // --- EXPOSE GLOBAL FUNCTIONS (Fix for onclick errors) ---
        // (Existing window exposure functions are omitted for brevity but assumed to be present)
        window.toggleSidebar = toggleSidebar;
        window.closeSidebar = closeSidebar;
        window.showUserView = showUserView;
        window.showAdminView = showAdminView;
        window.showMessageModal = showMessageModal;
        window.closeMessageModal = closeMessageModal;
        window.openPaymentInfoModal = openPaymentInfoModal;
        window.closePaymentInfoModal = closePaymentInfoModal;
        window.registerPlayAndOpenTokenInput = registerPlayAndOpenTokenInput;
        window.closeTokenInputModal = closeTokenInputModal;
        window.openProductModal = openProductModal;
        window.closeProductModal = closeProductModal;
        window.deleteProduct = deleteProduct;
        window.buyProduct = buyProduct;
        window.updatePlayStatus = updatePlayStatus;
        window.saveToken = saveToken;
        window.saveVoucher = saveVoucher;
        window.openAdminLoginModal = openAdminLoginModal;
        window.closeAdminLoginModal = closeAdminLoginModal;
        window.logoutAdmin = logoutAdmin;

        // --- FIREBASE PATHING ---
        function getProductsRef() {
            return ref(db, `artifacts/${appId}/public/data/products`);
        }
        function getMysteryPlaysRef(uid) {
             return ref(db, `artifacts/${appId}/users/${uid}/mystery_box_plays`);
        }
        function getAllMysteryPlaysAdminRef() {
            return ref(db, `artifacts/${appId}/users/`);
        }
        function getLeaderboardRef() {
            return ref(db, `artifacts/${appId}/public/data/leaderboard`);
        }


        // --- UI FUNCTIONS (omitted for brevity) ---
        const hamburgerBtn = document.getElementById('hamburger-btn');
        const sidebar = document.getElementById('mobile-sidebar');
        const overlay = document.getElementById('sidebar-overlay');
        const userView = document.getElementById('user-view');
        const adminView = document.getElementById('admin-view');
        const loadingSpinner = document.getElementById('loading-spinner');
        const adminLinks = document.querySelectorAll('.admin-link');
        const adminLoginBtn = document.getElementById('admin-login-btn');
        const adminLogoutBtn = document.getElementById('admin-logout-btn');


        function toggleSidebar() {
            const isOpen = sidebar.classList.toggle('open');
            overlay.classList.toggle('hidden', !isOpen);
            hamburgerBtn.querySelector('.hamburger-icon').classList.toggle('open', isOpen);
        }

        function closeSidebar() {
            sidebar.classList.remove('open');
            overlay.classList.add('hidden');
            hamburgerBtn.querySelector('.hamburger-icon').classList.remove('open');
        }

        hamburgerBtn.addEventListener('click', toggleSidebar);

        function updateAdminUI(isNowAdmin) {
            isAdmin = isNowAdmin;
            if (isNowAdmin) {
                document.body.classList.add('admin-active');
                adminLinks.forEach(link => link.classList.remove('hidden'));
                adminLoginBtn.classList.add('hidden');
                adminLogoutBtn.classList.remove('hidden');
            } else {
                document.body.classList.remove('admin-active');
                adminLinks.forEach(link => link.classList.add('hidden'));
                adminLoginBtn.classList.remove('hidden');
                adminLogoutBtn.classList.add('hidden');
                showUserView('home'); 
            }
        }

        function showView(viewId) {
            userView.classList.add('hidden');
            adminView.classList.add('hidden');
            
            if (viewId.startsWith('user')) {
                userView.classList.remove('hidden');
                document.querySelectorAll('.view-section').forEach(sec => sec.classList.add('hidden'));
                document.getElementById(viewId.replace('user-', 'user-')).classList.remove('hidden');
            } else if (viewId.startsWith('admin')) {
                adminView.classList.remove('hidden');
                document.querySelectorAll('.admin-section').forEach(sec => sec.classList.add('hidden'));
                document.getElementById(viewId.replace('admin-', 'admin-')).classList.remove('hidden');
            }
        }

        function showUserView(section) {
            showView('user-' + section);
        }

        function showAdminView(section) {
            if (isAdmin) {
                showView('admin-' + section);
            } else {
                showMessageModal('üö´ Akses Ditolak', 'Anda tidak memiliki izin akses sebagai Admin. Silahkan Login Admin terlebih dahulu.', 'text-red-500');
                showUserView('home');
            }
        }
        
        function showMessageModal(title, body, iconClass = 'text-indigo-500', icon = 'üéâ') {
            document.getElementById('modal-icon').innerHTML = icon;
            document.getElementById('modal-icon').className = `text-4xl mb-4 ${iconClass}`;
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-body').textContent = body;
            document.getElementById('message-modal').classList.remove('hidden');
            document.getElementById('message-modal').classList.add('flex');
        }

        function closeMessageModal() {
            document.getElementById('message-modal').classList.add('hidden');
            document.getElementById('message-modal').classList.remove('flex');
        }
        
        // --- ADMIN LOGIN MODAL FUNCTIONS ---
        
        function openAdminLoginModal() {
            document.getElementById('admin-login-error').classList.add('hidden');
            document.getElementById('admin-password').value = '';
            document.getElementById('admin-login-modal').classList.remove('hidden');
            document.getElementById('admin-login-modal').classList.add('flex');
        }

        function closeAdminLoginModal() {
            document.getElementById('admin-login-modal').classList.add('hidden');
            document.getElementById('admin-login-modal').classList.remove('flex');
        }
        
        document.getElementById('admin-login-form').addEventListener('submit', handleAdminLoginSubmit);
        
        function handleAdminLoginSubmit(e) {
            e.preventDefault();
            const password = document.getElementById('admin-password').value;
            const errorEl = document.getElementById('admin-login-error');

            if (password === ADMIN_PASSWORD) {
                closeAdminLoginModal();
                updateAdminUI(true); 
                showAdminView('manage-products');
                showMessageModal('Login Berhasil', 'Anda berhasil masuk sebagai Admin!', 'text-green-600', 'üîë');
            } else {
                errorEl.classList.remove('hidden');
            }
        }

        function logoutAdmin() {
            if (!confirm('Yakin ingin keluar dari Admin Panel?')) return;
            updateAdminUI(false); 
            showMessageModal('Logout Berhasil', 'Anda telah keluar dari Admin Panel.', 'text-red-500', 'üö™');
        }
        
        // Dummy function for product modal content
        function openProductModal() {
             const productModal = document.getElementById('product-modal');
             productModal.innerHTML = `
                 <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg p-6">
                     <h3 class="text-xl font-bold text-indigo-600 mb-4">Tambah/Edit Produk</h3>
                     <p class="text-gray-500">Fitur ini tidak diimplementasikan secara penuh. Gunakan Firebase Realtime Database langsung untuk data produk.</p>
                     <button onclick="closeProductModal()" class="mt-4 px-4 py-2 bg-indigo-600 text-white rounded-lg">Tutup</button>
                 </div>
             `;
             productModal.classList.remove('hidden');
             productModal.classList.add('flex');
        }
        function closeProductModal() {
             document.getElementById('product-modal').classList.add('hidden');
        }
        
        // Dummy function for buyProduct
        function buyProduct(productId, name) {
            showMessageModal('Pembelian', `Anda mencoba membeli produk: ${name}. Fitur checkout belum diimplementasikan.`, 'text-yellow-500', 'üõí');
        }
        
        function deleteProduct(productId, name) {
             showMessageModal('Hapus Produk', `Fitur hapus untuk produk ${name} belum diimplementasikan.`, 'text-red-500', 'üóëÔ∏è');
        }
        
        function formatRupiah(number) {
            return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(number);
        }

        function renderUserHome(products) {
            document.getElementById('total-products').textContent = Object.keys(products).length;
            // Additional home summaries can be added here
        }

        function renderUserProducts(products) {
            const listEl = document.getElementById('product-list');
            listEl.innerHTML = '';
            
            if (Object.keys(products).length === 0) {
                listEl.innerHTML = '<p class="col-span-4 text-center text-gray-500 p-8">Belum ada produk yang ditambahkan oleh Admin.</p>';
                return;
            }

            Object.entries(products).forEach(([id, product]) => {
                const card = `
                    <div class="bg-white rounded-xl shadow-lg hover:shadow-xl transition duration-300 overflow-hidden">
                        <img src="https://placehold.co/400x300/1e40af/ffffff?text=${product.name.substring(0, 10).replace(/ /g, '+')}" 
                             onerror="this.onerror=null;this.src='https://placehold.co/400x300/9ca3af/ffffff?text=Produk';" 
                             alt="${product.name}" class="w-full h-32 object-cover">
                        <div class="p-4">
                            <h4 class="font-bold text-lg text-gray-800 truncate">${product.name}</h4>
                            <p class="text-indigo-600 font-semibold mt-1">${formatRupiah(product.price)}</p>
                            <p class="text-sm text-gray-500">Stok: ${product.stock}</p>
                            <button onclick="buyProduct('${id}', '${product.name}')" class="mt-3 w-full py-2 bg-green-500 text-white font-medium rounded-lg hover:bg-green-600 transition">
                                Beli
                            </button>
                        </div>
                    </div>
                `;
                listEl.innerHTML += card;
            });
        }
        
        function renderAdminProducts(products) {
             const tableBody = document.getElementById('admin-product-table');
             tableBody.innerHTML = '';

             Object.entries(products).forEach(([id, product]) => {
                 const row = `
                    <tr class="hover:bg-gray-100">
                        <td class="px-6 py-4 text-sm font-medium text-gray-900">${product.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${product.stock}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatRupiah(product.price)}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <button onclick="openProductModal('${id}')" class="text-indigo-600 hover:text-indigo-900 mr-3">Edit</button>
                            <button onclick="deleteProduct('${id}', '${product.name}')" class="text-red-600 hover:text-red-900">Hapus</button>
                        </td>
                    </tr>
                `;
                tableBody.innerHTML += row;
             });
        }

        // (The rest of the user/admin functions for Mystery Box and Leaderboard are assumed to be here)

        // --- FIREBASE INITIALIZATION & AUTH (PERBAIKAN UTAMA) ---

        async function attemptSignIn() {
             try {
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                // If successful, onAuthStateChanged will fire again, hitting the 'if (user)' block.
            } catch (signInError) {
                console.error("Firebase Sign-In Attempt Failed:", signInError);
                // If sign-in fails (e.g., bad token, network), we stop the spinner and show UI
                isAuthReady = false;
                userId = 'guest_unauth';
                loadingSpinner.classList.add('hidden');
                showUserView('home');
                showMessageModal('Gagal Otorisasi', 'Gagal masuk ke Firebase. Aplikasi mungkin tidak dapat menyimpan data secara persisten.', 'text-red-500', '‚ö†Ô∏è');
            }
        }

        window.onload = async () => {
            try {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getDatabase(app);
                
                // Set up Auth State Listener
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        // --- SUCCESS PATH ---
                        userId = user.uid;
                        isAuthReady = true;
                        
                        updateAdminUI(false); 
                        setupRealtimeListeners();
                        
                        loadingSpinner.classList.add('hidden');
                        showUserView('home');

                    } else if (!isAuthReady) {
                        // --- INITIAL SIGN-IN ATTEMPT ---
                        // Only run this logic on the very first check (when isAuthReady is still false/initial)
                        await attemptSignIn();
                    }
                });
            } catch (error) {
                // --- CRITICAL INIT FAILURE PATH (Firebase App Initialization Failure) ---
                console.error("Error during Firebase initialization:", error);
                loadingSpinner.classList.add('hidden'); // CRUCIAL: Hide spinner on failure
                userView.classList.remove('hidden'); // Show the container
                document.getElementById('user-home').classList.remove('hidden');
                
                loadingSpinner.innerHTML = `<p class="text-red-600">Gagal memuat aplikasi. Cek koneksi atau konfigurasi Firebase. (${error.message})</p>`;
            }
        };
        
        function setupRealtimeListeners() {
            // Listen for Products (and other common listeners)
            onValue(getProductsRef(), (snapshot) => {
                const products = snapshot.val() || {};
                renderUserProducts(products);
                renderUserHome(products);
                if (isAdmin) {
                    renderAdminProducts(products);
                }
            });

            // Listen for Mystery Plays (Admin only)
            onValue(getAllMysteryPlaysAdminRef(), (snapshot) => {
                const allPlaysData = snapshot.val() || {};
                if (isAdmin) {
                    renderAdminMystery(allPlaysData);
                }
            });
            
            // Listen for User's Mystery Play Status
            if (userId) {
                onValue(getMysteryPlaysRef(userId), (snapshot) => {
                    const userPlays = snapshot.val() || {};
                    renderMysteryBoxUserStatus(userPlays);
                });
            }
            
            // Listen for Leaderboard
            onValue(getLeaderboardRef(), (snapshot) => {
                const winners = snapshot.val() || {};
                renderLeaderboard(winners);
            });
        }
        
        // --- MYSTERY BOX LOGIC (USER) ---
        
        function getLatestPlay(userPlays) {
            if (!userPlays) return null;
            const playsArray = Object.entries(userPlays).map(([playId, play]) => ({ playId, ...play }));
            if (playsArray.length === 0) return null;
            return playsArray.sort((a, b) => b.timestamp - a.timestamp)[0];
        }

        function openPaymentInfoModal() {
            if (!isAuthReady) return showMessageModal('Otorisasi', 'Sedang memuat otorisasi. Mohon tunggu sebentar.', 'text-yellow-500', '‚è≥');
            
            document.getElementById('payment-info-modal').classList.remove('hidden');
            document.getElementById('payment-info-modal').classList.add('flex');
        }

        function closePaymentInfoModal() {
            document.getElementById('payment-info-modal').classList.add('hidden');
            document.getElementById('payment-info-modal').classList.remove('flex');
        }
        
        function closeTokenInputModal() {
            document.getElementById('token-input-modal').classList.add('hidden');
            document.getElementById('token-input-modal').classList.remove('flex');
            document.getElementById('token-error').classList.add('hidden');
        }

        async function registerPlayAndOpenTokenInput() {
            closePaymentInfoModal();
            if (!isAuthReady || !userId) return showMessageModal('Otorisasi', 'Autentikasi belum siap.', 'text-yellow-500', '‚è≥');

            const userPlaysRef = getMysteryPlaysRef(userId);
            const snapshot = await get(userPlaysRef);
            const userPlays = snapshot.val() || {};
            const latestPlay = getLatestPlay(userPlays);
            
            if (latestPlay && latestPlay.isWinner === undefined) {
                latestPlayId = latestPlay.playId;
            } else {
                const playRef = push(userPlaysRef);
                latestPlayId = playRef.key;
                const newPlayData = {
                    userId: userId,
                    timestamp: Date.now(),
                    token: null, 
                    isWinner: undefined, 
                    voucher: null,
                };
                await set(playRef, newPlayData);
            }
            
            document.getElementById('token-input-modal').classList.remove('hidden');
            document.getElementById('token-input-modal').classList.add('flex');
        }

        document.getElementById('token-form').addEventListener('submit', handleTokenSubmit);

        async function handleTokenSubmit(e) {
            e.preventDefault();
            const submittedToken = document.getElementById('mystery-token').value.toUpperCase();
            const errorEl = document.getElementById('token-error');

            if (!latestPlayId) {
                errorEl.textContent = 'Tidak ada riwayat pembelian. Silahkan ulangi langkah beli.';
                errorEl.classList.remove('hidden');
                return;
            }
            
            try {
                const playRef = ref(db, `artifacts/${appId}/users/${userId}/mystery_box_plays/${latestPlayId}`);
                const snapshot = await get(playRef);
                const latestPlay = snapshot.val();
                
                if (!latestPlay) {
                    errorEl.textContent = 'Data pembelian tidak ditemukan.';
                    errorEl.classList.remove('hidden');
                    return;
                }

                if (!latestPlay.token) {
                    errorEl.textContent = 'Admin belum memasukkan token untuk pembelian Anda. Mohon hubungi Admin.';
                    errorEl.classList.remove('hidden');
                    return;
                }

                if (latestPlay.token === submittedToken && latestPlay.isWinner === undefined) {
                    
                    if (latestPlay.isWinner === true) {
                        showMessageModal('ANDA MENANG!', `Selamat! Anda mendapatkan voucher tukar: ${latestPlay.voucher || 'Voucher Tidak Tersedia'}. Screenshot dan kirim ke WA Admin!`, 'text-green-700', 'üèÜ');
                    } else { 
                        showMessageModal('Coba Lagi Nanti üò•', 'Anda belum beruntung. Coba lagi di kesempatan berikutnya!', 'text-red-600', 'üò•');
                    }
                    
                    await update(playRef, { isWinner: latestPlay.isWinner }); 
                    
                    closeTokenInputModal();

                } else if (latestPlay.token === submittedToken && latestPlay.isWinner !== undefined) {
                    errorEl.textContent = 'Token ini sudah digunakan. Lihat status Anda di bawah.';
                    errorEl.classList.remove('hidden');
                } else {
                    errorEl.textContent = 'Token salah. Mohon periksa kembali token Anda.';
                    errorEl.classList.remove('hidden');
                }
                
            } catch (error) {
                console.error("Error opening mystery box:", error);
                errorEl.textContent = 'Terjadi error saat memproses. Coba lagi.';
                errorEl.classList.remove('hidden');
            }
        }

        function renderMysteryBoxUserStatus(userPlays) {
            const statusEl = document.getElementById('mystery-box-status');
            const ctaBtn = document.getElementById('mystery-box-cta');
            
            statusEl.innerHTML = '';

            const latestPlay = getLatestPlay(userPlays);
            latestPlayId = latestPlay ? latestPlay.playId : null;
            
            ctaBtn.textContent = 'Beli Mystery Box / Lihat Info';
            ctaBtn.onclick = openPaymentInfoModal;

            if (!latestPlay) {
                statusEl.innerHTML = '<p class="text-gray-500">Anda belum membeli Mystery Box. Silahkan Beli di atas.</p>';
                return;
            }
            
            if (!latestPlay.token) {
                statusEl.innerHTML = `
                    <p class="text-yellow-600 font-semibold mt-4">‚è≥ Menunggu Token dari Admin...</p>
                    <p class="text-sm text-gray-500 mt-2">Pastikan sudah kirim bukti bayar ke WA Admin. User ID Anda: <span class="font-bold">${userId}</span></p>
                `;
                ctaBtn.textContent = 'Lihat Status Pembelian';
                ctaBtn.onclick = openPaymentInfoModal;

            } else if (latestPlay.token && latestPlay.isWinner === undefined) {
                 statusEl.innerHTML = `
                    <p class="text-green-600 font-semibold mt-4">‚úÖ Token Diberikan! Klik di bawah untuk membuka.</p>
                    <p class="text-sm text-gray-500 mt-2">Masukkan token yang Anda terima untuk membuka kotak.</p>
                `;
                ctaBtn.textContent = 'Buka Mystery Box Sekarang!';
                ctaBtn.onclick = registerPlayAndOpenTokenInput; 
                
            } else if (latestPlay.isWinner === true) {
                statusEl.innerHTML = `
                    <p class="text-green-700 font-extrabold text-2xl mt-4">ANDA MENANG! üéâ</p>
                    <p class="text-lg font-semibold mt-2">Voucher Tukar Hadiah:</p>
                    <p class="text-3xl font-mono text-indigo-700 bg-yellow-100 p-2 rounded-lg break-all">${latestPlay.voucher || 'Voucher Tidak Tersedia'}</p>
                    <p class="text-sm text-gray-600 mt-4">Segera screenshot dan kirim kode voucher ini ke WA Admin!</p>
                `;
                ctaBtn.textContent = 'Beli Lagi';
                ctaBtn.onclick = openPaymentInfoModal;

            } else if (latestPlay.isWinner === false) {
                statusEl.innerHTML = `
                    <p class="text-red-600 font-extrabold text-2xl mt-4">Coba Lagi Nanti üò•</p>
                    <p class="text-sm text-gray-500 mt-2">Anda belum beruntung. Silahkan beli lagi untuk kesempatan baru.</p>
                `;
                ctaBtn.textContent = 'Beli Lagi';
                ctaBtn.onclick = openPaymentInfoModal;
            }
        }


        // --- MYSTERY BOX LOGIC (ADMIN) ---

        function renderAdminMystery(allPlaysData) {
            if (!isAdmin) return; 
            
            const tableBody = document.getElementById('admin-mystery-table');
            const totalUsersEl = document.getElementById('total-mystery-users');
            tableBody.innerHTML = '';
            
            const groupedPlays = {};
            let uniqueUsers = new Set();

            for (const uid in allPlaysData) {
                // Ensure we only process nodes that contain mystery_box_plays
                if (allPlaysData[uid].mystery_box_plays) {
                    groupedPlays[uid] = Object.entries(allPlaysData[uid].mystery_box_plays || {}).map(([key, play]) => ({ playId: key, ...play }));
                    if (groupedPlays[uid].length > 0) {
                         uniqueUsers.add(uid);
                    }
                }
            }
            totalUsersEl.textContent = uniqueUsers.size;

            const allPlaysList = Object.values(groupedPlays).flat().sort((a, b) => b.timestamp - a.timestamp);


            allPlaysList.forEach((play) => {
                const uid = play.userId;
                const playRefPath = `artifacts/${appId}/users/${uid}/mystery_box_plays/${play.playId}`;
                const time = new Date(play.timestamp).toLocaleString('id-ID');
                
                const tokenInput = `
                    <div class="flex items-center space-x-2">
                        <input type="text" id="token-${play.playId}" value="${play.token || ''}" 
                            maxlength="6" placeholder="A1B2C3"
                            class="w-20 border border-gray-300 rounded-md p-1 text-xs font-mono uppercase">
                        <button onclick="saveToken('${playRefPath}', document.getElementById('token-${play.playId}').value, '${uid}')" 
                            class="text-sm text-indigo-600 hover:text-indigo-900">Set</button>
                    </div>
                `;
                
                // If token is not set, disable win/lose options
                const isTokenSet = !!play.token;
                
                const isWinnerCheckbox = `
                    <input type="checkbox" ${play.isWinner === true ? 'checked' : ''} 
                        ${!isTokenSet ? 'disabled' : ''}
                        onchange="updatePlayStatus('${playRefPath}', 'isWinner', this.checked, '${uid}', '${play.playId}')"
                        class="h-4 w-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
                `;

                const isWinnerConfirmed = play.isWinner === true;
                const voucherInput = `
                    <div class="flex items-center space-x-2">
                        <input type="text" id="voucher-${play.playId}" value="${play.voucher || ''}" 
                            class="w-24 border border-gray-300 rounded-md p-1 text-xs" 
                            placeholder="Voucher Code" ${!isWinnerConfirmed ? 'disabled' : ''}>
                        <button onclick="saveVoucher('${playRefPath}', document.getElementById('voucher-${play.playId}').value, '${uid}')" 
                            class="text-sm text-indigo-600 hover:text-indigo-900" ${!isWinnerConfirmed ? 'disabled' : ''}>Simpan</button>
                    </div>
                `;

                let rowClass = 'bg-white';
                if (play.isWinner === true) { rowClass = 'bg-green-100'; }
                else if (play.isWinner === false) { rowClass = 'bg-red-100'; }
                else if (play.token) { rowClass = 'bg-yellow-50'; } 

                const row = `
                    <tr class="${rowClass} hover:bg-gray-100 transition">
                        <td class="px-6 py-4 text-sm font-medium text-gray-900 break-all">${uid}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${time}</td>
                        <td class="px-6 py-4 text-sm text-gray-500">${tokenInput}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-center">${isWinnerCheckbox}</td>
                        <td class="px-6 py-4 text-sm text-gray-500">${voucherInput}</td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }

        async function saveToken(path, token, winnerUid) {
            if (!isAdmin) return showAdminView('manage-mystery');
            
            const formattedToken = token.toUpperCase().trim();
            if (formattedToken.length !== 6 || !/^[A-Z0-9]{6}$/.test(formattedToken)) {
                 return showMessageModal('Gagal', 'Token harus 6 karakter (huruf/angka) dan tidak boleh kosong.', 'text-red-500', '‚ö†Ô∏è');
            }
            
            const playRef = ref(db, path);
            
            try {
                 await update(playRef, { token: formattedToken });
                 showMessageModal('Token Tersimpan', `Token (${formattedToken}) berhasil disimpan. Berikan ini ke user.`, 'text-green-600', 'üíæ');
            } catch(error) {
                console.error("Error saving token:", error);
                showMessageModal('Error', 'Gagal menyimpan token.', 'text-red-500', '‚ùå');
            }
        }
        
        async function updatePlayStatus(path, field, value, winnerUid, playId) {
            if (!isAdmin) return showAdminView('manage-mystery');
            
            const playRef = ref(db, path);
            const updates = {};
            
            try {
                if (field === 'isWinner') {
                    updates[field] = value;
                    // Only generate/set voucher if setting to true
                    if (value === true) {
                        updates.voucher = updates.voucher || generateVoucherCode(); 
                        
                        // Update/Add to leaderboard
                        const leaderboardRef = ref(getLeaderboardRef(), winnerUid);
                        await set(leaderboardRef, {
                            userId: winnerUid,
                            voucher: updates.voucher,
                            date: new Date().toISOString()
                        });
                    } else if (value === false) {
                        // If setting to false, remove from leaderboard and clear voucher in play record
                        updates.voucher = null;
                        await remove(ref(getLeaderboardRef(), winnerUid));
                    }
                } 

                await update(playRef, updates);
                showMessageModal('Update Sukses', `Status ${field} berhasil diperbarui!`, 'text-green-600', 'üëç');
            } catch (error) {
                console.error("Error updating play status:", error);
                showMessageModal('Error', 'Gagal memperbarui status.', 'text-red-500', '‚ùå');
            }
        }
        
        async function saveVoucher(path, voucherCode, winnerUid) {
            if (!isAdmin) return showAdminView('manage-mystery');
            
            if (!voucherCode) {
                 return showMessageModal('Gagal', 'Kode voucher tidak boleh kosong.', 'text-red-500', '‚ö†Ô∏è');
            }
            
            const playRef = ref(db, path);
            
            try {
                 await update(playRef, { voucher: voucherCode });
                 
                 const leaderboardRef = ref(getLeaderboardRef(), winnerUid);
                 await update(leaderboardRef, { voucher: voucherCode });
                 
                 showMessageModal('Voucher Tersimpan', 'Kode voucher berhasil disimpan.', 'text-green-600', 'üíæ');
            } catch(error) {
                console.error("Error saving voucher:", error);
                showMessageModal('Error', 'Gagal menyimpan voucher.', 'text-red-500', '‚ùå');
            }
        }

        function generateVoucherCode() {
            return 'VCHR-' + Math.random().toString(36).substring(2, 8).toUpperCase();
        }
        
        
        // --- LEADERBOARD LOGIC ---

        function renderLeaderboard(winners) {
            const tableBody = document.getElementById('leaderboard-table');
            tableBody.innerHTML = '';
            
            const winnerList = Object.values(winners || {});
            
            if (winnerList.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="4" class="px-6 py-4 text-center text-gray-500">Belum ada pemenang tercatat.</td></tr>';
                return;
            }

            winnerList.sort((a, b) => new Date(b.date) - new Date(a.date));

            winnerList.forEach((winner, index) => {
                const date = new Date(winner.date).toLocaleDateString('id-ID');
                const row = `
                    <tr class="hover:bg-yellow-50 transition">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${index + 1}</td>
                        <td class="px-6 py-4 text-sm text-gray-500 break-all">${winner.userId}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-lg font-bold text-indigo-600">${winner.voucher}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${date}</td>
                    </tr>
                `;
                tableBody.innerHTML += row;
            });
        }

    </script>
</body>
</html>